    <template>
      <div class="page" data-name="stories">
        <div class="navbar">
          <div class="navbar-inner">
            <div class="title sliding">HackerNews7</div>
            <div class="right">
              <a class="link icon-only searchbar-enable" data-searchbar=".searchbar-components">
                <i class="icon f7-icons ios-only">search_strong</i>
                <i class="icon material-icons md-only">search</i>
              </a>
            </div>
          </div>
        </div>
          <div data-infinite-distance="50" class="page-content infinite-scroll-content" @infinite="loadMore">
            <div class="list">
              <ul>
                {{#each stories}}
                <li>
                <a href="/storie/{{id}}/" class="item-link">
                  <div class="item-content">
                    <div class="item-inner">
                      <div class="item-title">
                      {{title}} ({{domain}})
                      <div class="item-footer">{{points}} {{pluralize points single="point" multiple="points"}} {{#if user}} by {{user}} {{/if}}{{time_ago}}</div>
                      </div>
                      {{#if comments_count}}<div class="item-after"><span class="badge">{{comments_count}}</span></div>{{/if}}
                    </div>
                  </div>
                </a>
                </li>
              {{/each}}
              </ul>
            </div>
            {{#if hasMoreItems}}
            <div class="preloader infinite-scroll-preloader"></div>
            {{/if}}
          </div>
        </div>
      </template>
      <script>
        return {
          data: function () {
            var self = this;
            var app = self.$app;
            var endpoint = app.data.api.endpoints[0];
            return {
              endpoint : endpoint,
              allowInfinite: true,
              hasMoreItems: true,
              lastPage: 1,
              stories: [],
            }
          },
          methods: {
            fetchStories(page) {
                var self = this;
                var app = self.$app;
                var url = self.endpoint.url.substring(0, self.endpoint.url.lastIndexOf('/')+1);
                app.request.json(url + page + '.json', (items) => {
                    var stories = self.stories.concat(items);
                    self.$setState({
                        stories: stories,
                        lastPage: page
                    })
                })
            },
            loadMore() {
                var self = this;
        
                var $ = self.$$;
                if (!self.allowInfinite) return;
                self.allowInfinite = false;
                
                if (self.lastPage >= self.endpoint.maxPages) {
                    self.$setState({
                        hasMoreItems: false
                    })
                    return
                }
                
                self.fetchStories(self.lastPage +1)
                self.allowInfinite = true;
            }
          },
          on: {
            pageInit() {
                var self = this;
                self.fetchStories(self.lastPage);
            }, 
          }
        }
      </script>