<template>
        <div class="page" data-name="stories">
            <div class="navbar">
              <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title sliding">HackerNews7</div>
              </div>
            </div>
            <div class="toolbar tabbar">
              <div class="toolbar-inner">
                {{#each endpoints}}
                    <a href="#tab-{{@index}}" class="tab-link{{#js @first}} tab-link-active{{/if}}" @click="loadStories({{@index}})">{{this.label}}</a>
                {{/each}}
              </div>
            </div>
            <div class="tabs">
            {{#each endpoints}}
                <div id="tab-{{@index}}" class="tab page-content{{#js_if '@root.currentTab === @index'}} tab-active{{/js_if}}">
                    <div class="list">
                        <ul>
                        {{#each @root.stories}}
                            <li class="item-content">
                                <div class="item-inner">
                                    <div class="item-title">
                                        {{title}} ({{domain}})
                                        <div class="item-footer">{{points}} {{pluralize points single="point" multiple="points"}} {{#if user}} by {{user}} {{/if}}{{time_ago}}</div>
                                    </div>
                                    {{#if comments_count}}<div class="item-after"><span class="badge">{{comments_count}}</span></div>{{/if}}
                                </div>
                            </li>
                        {{/each}}
                        </ul>
                    </div>
                </div>
                {{/each}}
            </div>
    </template>
    <script>
        return {
            data() {
                return {
                    currentTab: 0,
                    stories: null,
                    endpoints: [
                        {
                            label: 'top',
                            endpoint: 'news',
                        },
                        {
                            label: 'new',
                            endpoint: 'newest',
                        },
                        {
                            label: 'ask',
                            endpoint: 'ask',
                        },
                        {
                            label: 'jobs',
                            endpoint: 'jobs',
                        },
                        {
                            label: 'show',
                            endpoint: 'show',
                        },
                    ],
                }
            },
            methods: {
                loadStories(index) {
                    var self = this;
                    var app = self.$app;
                    app.request.json('https://api.hnpwa.com/v0/' + this.endpoints[index].endpoint + '.json', (stories) => {
                        self.$setState({
                            stories: stories,
                            currentTab: index,
                        })
                    })
                }
            },
            on: {
                pageInit() {
                    var self = this;
                    self.loadStories(0);
                },
            },
        }
    </script>