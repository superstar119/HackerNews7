<template>
    <div class="page" data-name="stories">
        {{#storie}}
        <div class="navbar">
          <div class="navbar-inner">
            <div class="left">
                <a href="#" class="link back">
                    <i class="icon icon-back"></i>
                    <span class="ios-only">Back</span>
                </a>
            </div>
            <div class="title sliding">{{title}}</div>
          </div>
        </div>
        <div class="page-content messages-content">
                <div class="messages messages-init">
                    <div class="messages-title">{{title}}</div>
                    <div class="messages-title">{{points}} {{pluralize points single="point" multiple="points"}} {{#if user}} by {{user}} {{/if}}- {{time_ago}}</div>
                    <div class="messages-title">{{domain}}</div>
                {{#comments}}
                <div class="message message-received">
                    <div class="message-content">
                        <div class="message-name">{{user}}</div>
                        <div class="message-bubble">
                            <div class="message-text">{{content}}</div>
                        </div>
                    </div>
                </div>
                    {{#each comments}}
                    <div class="message message-send">
                        <div class="message-content">
                            <div class="message-name">{{this.user}}</div>
                            <div class="message-bubble">
                                <div class="message-text">{{this.content}}</div>
                            </div>
                        </div>
                    </div>
                    {{/each}}  
                {{/comments}}
                </div>
        </div>
        {{/storie}}
    </div>
</template>
<script>
    return {
        data() {
            return {
                storie : null
            }
        },
        methods: {
            fetchStorie(id) {
                var self = this;
                var app = self.$app;
                app.request.json('https://api.hnpwa.com/v0/item/' + id + '.json', (storie) => {
                    self.$setState({
                        storie: storie
                    })
                })
            }
        },
        on: {
            pageInit() {
                var self = this;
                self.fetchStorie(self.$route.params.id);
            },
        },
    }
</script>